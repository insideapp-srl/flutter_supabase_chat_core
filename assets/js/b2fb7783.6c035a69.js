"use strict";(self.webpackChunkflutter_supabase_chat_core=self.webpackChunkflutter_supabase_chat_core||[]).push([[830],{9654:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>u,contentTitle:()=>o,default:()=>l,frontMatter:()=>i,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"guides/supabase-views","title":"Database Views","description":"Rooms view","source":"@site/docs/guides/supabse-views.md","sourceDirName":"guides","slug":"/guides/supabase-views","permalink":"/guides/supabase-views","draft":false,"unlisted":false,"editUrl":"https://github.com/insideapp-srl/flutter_supabase_chat_core/docs/guides/supabse-views.md","tags":[],"version":"current","frontMatter":{"id":"supabase-views","title":"Database Views"},"sidebar":"tutorialSidebar","previous":{"title":"Database Triggers","permalink":"/guides/supabase-triggers"},"next":{"title":"Database Indexes","permalink":"/guides/supabase-indexes"}}');var a=t(4848),r=t(8453);const i={id:"supabase-views",title:"Database Views"},o=void 0,u={},c=[{value:"Rooms view",id:"rooms-view",level:2}];function d(e){const s={code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h2,{id:"rooms-view",children:"Rooms view"}),"\n",(0,a.jsxs)(s.p,{children:["This is a view of ",(0,a.jsx)(s.code,{children:"rooms"})," table, this view allows you to obtain the name of the sender of the message dynamically in direct rooms, based on the logged-in user the name of the correspondent is displayed."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:'DROP VIEW IF EXISTS chats.rooms_l;\ncreate view chats.rooms_l\n    WITH (security_invoker=\'on\') as\nselect\n    r.id,\n    r."imageUrl",\n    r.metadata,\n    case\n        when r.type = \'direct\' and auth.uid() is not null then\n            (select coalesce(u."firstName", \'\') || \' \' || coalesce(u."lastName", \'\')\n             from chats.users u\n             where u.id = any(r."userIds") and u.id <> auth.uid()\n             limit 1)\n        else\n            r.name\n        end as name,\n    r.type,\n    r."userIds",\n    r."lastMessages",\n    r."userRoles",\n    r."createdAt",\n    r."updatedAt"\nfrom chats.rooms r;\n'})})]})}function l(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>i,x:()=>o});var n=t(6540);const a={},r=n.createContext(a);function i(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);