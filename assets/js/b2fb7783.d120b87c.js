"use strict";(self.webpackChunkflutter_supabase_chat_core=self.webpackChunkflutter_supabase_chat_core||[]).push([[830],{9654:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>l,frontMatter:()=>i,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"guides/supabase-views","title":"Database Views","description":"Rooms view","source":"@site/docs/guides/supabse-views.md","sourceDirName":"guides","slug":"/guides/supabase-views","permalink":"/guides/supabase-views","draft":false,"unlisted":false,"editUrl":"https://github.com/insideapp-srl/flutter_supabase_chat_core/docs/guides/supabse-views.md","tags":[],"version":"current","frontMatter":{"id":"supabase-views","title":"Database Views"},"sidebar":"tutorialSidebar","previous":{"title":"Database Triggers","permalink":"/guides/supabase-triggers"},"next":{"title":"Database Indexes","permalink":"/guides/supabase-indexes"}}');var a=t(4848),r=t(8453);const i={id:"supabase-views",title:"Database Views"},o=void 0,d={},u=[{value:"Rooms view",id:"rooms-view",level:2},{value:"Messages view",id:"messages-view",level:2}];function c(e){const s={code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h2,{id:"rooms-view",children:"Rooms view"}),"\n",(0,a.jsxs)(s.p,{children:["This is a view of ",(0,a.jsx)(s.code,{children:"rooms"})," table, this view allows you to obtain the name of the sender of the message dynamically in direct rooms, based on the logged-in user the name of the correspondent is displayed, it is also included the list of uses member objects."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:'create or replace view chats.rooms_l\n    with (security_invoker=\'on\') as\nselect r.id,\n       r."imageUrl",\n       r.metadata,\n       case\n           when r.type = \'direct\' and auth.uid() is not null then\n               (select coalesce(u."firstName", \'\') || \' \' || coalesce(u."lastName", \'\')\n                from chats.users u\n                where u.id = any (r."userIds")\n                  and u.id <> auth.uid()\n                limit 1)\n           else\n               r.name\n           end                          as name,\n       r.type,\n       r."userIds",\n       r."lastMessages",\n       r."userRoles",\n       r."createdAt",\n       r."updatedAt",\n       (select jsonb_agg(to_jsonb(u))\n        from chats.users u\n        where u.id = any (r."userIds")) as users\nfrom chats.rooms r;\n'})}),"\n",(0,a.jsx)(s.h2,{id:"messages-view",children:"Messages view"}),"\n",(0,a.jsxs)(s.p,{children:["This is a view of ",(0,a.jsx)(s.code,{children:"messages"})," table, this view allows you to obtain the author user object and room object."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sql",children:'create or replace view chats.messages_l\n    with (security_invoker=\'on\') as\nselect m.id,\n       m."createdAt",\n       m.metadata,\n       m.duration,\n       m."mimeType",\n       m.name,\n       m."remoteId",\n       m."repliedMessage",\n       m."roomId",\n       m."showStatus",\n       m.size,\n       m.status,\n       m.type,\n       m."updatedAt",\n       m.uri,\n       m."waveForm",\n       m."isLoading",\n       m.height,\n       m.width,\n       m."previewData",\n       m."authorId",\n       m.text,\n       to_jsonb(u) as author,\n       to_jsonb(r) as room\nfrom chats.messages m\n         left join chats.users u on u.id = m."authorId"\n         left join chats.rooms_l r on r.id = m."roomId";\n'})})]})}function l(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>i,x:()=>o});var n=t(6540);const a={},r=n.createContext(a);function i(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);